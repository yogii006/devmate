<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DevMate Auth</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        font-family: Inter, Arial, sans-serif;
        margin: 0;
        background: #f7fafc;
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
    }

    .container {
        width: 100%;
        height: 90vh;
        padding: 40px;
        background: #ffffff;
        border-radius: 0;
        box-shadow: 0 6px 18px rgba(0,0,0,0.04);
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        margin: 0 0 20px;
        font-size: 32px;
    }

    .tabs {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
    }

    .tabs button {
        padding: 10px 20px;
        background: #e5e7eb;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background .2s;
    }

    .tabs button.active {
        background: #0366d6;
        color: #fff;
    }

    form {
        display: flex;
        flex-direction: column;
        gap: 14px;
        width: 360px;
    }

    input {
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 6px;
    }

    .btn {
        padding: 12px;
        background: #0366d6;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
    }

    .btn:hover {
        background: #024f9a;
    }

    .note {
        margin-top: 15px;
        font-size: 14px;
        color: #666;
    }

    .info {
        color: red;
        font-size: 14px;
        margin-top: 5px;
        display: none;
    }
</style>
</head>

<body>

<div class="container">
    <h1>DevMate Auth</h1>

    <div class="tabs">
        <button id="loginTab" class="active" onclick="switchTab('login')">Login</button>
        <button id="signupTab" onclick="switchTab('signup')">Signup</button>
    </div>

    <!-- LOGIN FORM -->
    <form id="loginForm" onsubmit="login(event)">
        <input type="text" id="loginUsername" placeholder="Username" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button class="btn" type="submit">Login</button>
        <p class="info" id="loginInfo"></p>
    </form>

    <!-- SIGNUP FORM -->
    <form id="signupForm" style="display:none;" onsubmit="signup(event)">
        <input type="text" id="signupUsername" placeholder="Create Username" required>
        <input type="password" id="signupPassword" placeholder="Create Password" required>
        <button class="btn" type="submit">Signup</button>
        <p class="info" id="signupInfo"></p>
    </form>

    <p class="note">Your session token will be securely saved in your browser.</p>
</div>


<script>
// Toggle UI
function switchTab(mode) {
    document.getElementById("loginTab").classList.remove("active");
    document.getElementById("signupTab").classList.remove("active");
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("signupForm").style.display = "none";

    if (mode === "login") {
        document.getElementById("loginTab").classList.add("active");
        document.getElementById("loginForm").style.display = "flex";
    } else {
        document.getElementById("signupTab").classList.add("active");
        document.getElementById("signupForm").style.display = "flex";
    }
}

// LOGIN FUNCTION
async function login(event) {
    event.preventDefault();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;
    const info = document.getElementById("loginInfo");

    try {
        const res = await fetch("http://127.0.0.1:8000/login", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({username, password})
        });

        const data = await res.json();

        if (res.ok && data.access_token) {
            localStorage.setItem("dev_token", data.access_token);
            localStorage.setItem("dev_user", username);
            window.location.href = "chat.html";
        } else {
            info.style.display = "block";
            info.textContent = data.detail || "Login failed";
        }
    } catch (error) {
        info.style.display = "block";
        info.textContent = "Server error";
    }
}

// SIGNUP FUNCTION
async function signup(event) {
    event.preventDefault();
    const username = document.getElementById("signupUsername").value;
    const password = document.getElementById("signupPassword").value;
    const info = document.getElementById("signupInfo");

    try {
        const res = await fetch("http://127.0.0.1:8000/signup", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({username, password})
        });

        const data = await res.json();

        if (res.ok) {
            info.style.display = "block";
            info.style.color = "green";
            info.textContent = "Signup successful! Please Login.";
        } else {
            info.style.display = "block";
            info.textContent = data.detail || "Signup failed";
        }
    } catch (error) {
        info.style.display = "block";
        info.textContent = "Server error";
    }
}
</script>

</body>
</html>
